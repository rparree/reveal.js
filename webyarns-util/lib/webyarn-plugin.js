"use strict";

/// <reference path ="../../node_modules/@types/reveal/index.d.ts"/>
(function () {
  var plugin = {
    init: function init() {
      var style = document.createElement('style');
      document.head.appendChild(style);
      Reveal.addEventListener('slidechanged', function (event) {
        addSupportForTimedSections(event);
        addSupportForOneTimeSections(event);
      });
      addSupportForAnchorWithDataLink(style.sheet);
      addSupportForProceedToNextAfterVideoPlayed();
    }
  };
  /**
   * Automatic proceed to next slide  once a video has completed
   */

  function addSupportForProceedToNextAfterVideoPlayed() {
    document.querySelectorAll("video[data-auto-next]").forEach(function (v) {
      v.addEventListener('ended', function (_) {
        return Reveal.next();
      });
    });
  }
  /**
   * allows for
   * `<a data-link-indexh="1">link to slide</a>`
   * @param webyarnsCSS
   */


  function addSupportForAnchorWithDataLink(webyarnsCSS) {
    webyarnsCSS.insertRule("a[data-link-indexh] { cursor: pointer }", 0);
    document.querySelectorAll("a[data-link-indexh]").forEach(function (e) {
      return e.addEventListener("click", function (evt) {
        evt.preventDefault();
        var s = e.getAttribute("data-link-indexh");

        if (s) {
          var idx = parseInt(s, 10);
          Reveal.slide(idx);
        }
      });
    });
  }

  function isIndex(value) {
    return /^\d+$/.test(value);
  }
  /**
   *
   * Syntax
   * <section data-auto-move-to="..." data-auto-move-time-sec="..>
   *
   * Automatically moves to a section after a timeout
   * Possible values for data-auto-move-to:
   *  - 'next' and 'prev'
   *  - a url hash value ('#/some-id')
   *  - id of a section ('some-id')
   *  - an position (one-based) of a section ('12')
   *
   *  data-auto-move-time-sec is optional. Defaults to 1 second
   */


  function addSupportForTimedSections(event) {
    var rx = /random\(([0-9,\s]+)\)/;
    var curAutoMove = event.currentSlide.getAttribute("data-auto-move-to");

    if (curAutoMove) {
      var providedValue = event.currentSlide.getAttribute("data-auto-move-time-sec");
      var timeout = providedValue ? Number.parseFloat(providedValue) * 1000 : 1;
      var match = curAutoMove.match(rx);
      var timer = setTimeout(function () {
        if (curAutoMove === "next") {
          Reveal.next();
        } else if (curAutoMove === "prev") {
          Reveal.prev();
        } else if (curAutoMove.charAt(0) === "#") {
          document.location.hash = curAutoMove;
        } else if (match) {
          var values = match[1].split(",").map(function (e) {
            return e.trim();
          }).map(function (i) {
            return Number.parseInt(i, 10);
          });
          var random = values[Math.floor(Math.random() * values.length)];
          Reveal.slide(random);
        } else if (isIndex(curAutoMove)) {
          var slide = parseInt(curAutoMove, 10) - 1;
          Reveal.slide(slide);
        } else {
          var i = Webyarns.lookupIndex(curAutoMove);

          if (i === -1) {
            console.error("get not find slide with id", curAutoMove);
          }

          Reveal.slide(i);
        }
      }, timeout);
      Reveal.addEventListener('slidechanged', function () {
        return clearTimeout(timer);
      });
    }
  }
  /**
   * syntax <section one-time>
   *
   * Section is shown only one time
   */


  function addSupportForOneTimeSections(event) {
    var prevSlide = event.previousSlide;
    if (!prevSlide) return;
    var onetime = prevSlide.getAttribute("data-one-time");
    if (onetime) prevSlide.setAttribute("data-hidden-section", "true");
  } // @ts-ignore


  Reveal.registerPlugin('WebyarnPlugin', plugin);
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy93ZWJ5YXJuLXBsdWdpbi50cyJdLCJuYW1lcyI6WyJwbHVnaW4iLCJpbml0Iiwic3R5bGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJSZXZlYWwiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJhZGRTdXBwb3J0Rm9yVGltZWRTZWN0aW9ucyIsImFkZFN1cHBvcnRGb3JPbmVUaW1lU2VjdGlvbnMiLCJhZGRTdXBwb3J0Rm9yQW5jaG9yV2l0aERhdGFMaW5rIiwic2hlZXQiLCJhZGRTdXBwb3J0Rm9yUHJvY2VlZFRvTmV4dEFmdGVyVmlkZW9QbGF5ZWQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInYiLCJfIiwibmV4dCIsIndlYnlhcm5zQ1NTIiwiaW5zZXJ0UnVsZSIsImUiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInMiLCJnZXRBdHRyaWJ1dGUiLCJpZHgiLCJwYXJzZUludCIsInNsaWRlIiwiaXNJbmRleCIsInZhbHVlIiwidGVzdCIsInJ4IiwiY3VyQXV0b01vdmUiLCJjdXJyZW50U2xpZGUiLCJwcm92aWRlZFZhbHVlIiwidGltZW91dCIsIk51bWJlciIsInBhcnNlRmxvYXQiLCJtYXRjaCIsInRpbWVyIiwic2V0VGltZW91dCIsInByZXYiLCJjaGFyQXQiLCJsb2NhdGlvbiIsImhhc2giLCJ2YWx1ZXMiLCJzcGxpdCIsIm1hcCIsInRyaW0iLCJpIiwicmFuZG9tIiwiTWF0aCIsImZsb29yIiwibGVuZ3RoIiwiV2VieWFybnMiLCJsb29rdXBJbmRleCIsImNvbnNvbGUiLCJlcnJvciIsImNsZWFyVGltZW91dCIsInByZXZTbGlkZSIsInByZXZpb3VzU2xpZGUiLCJvbmV0aW1lIiwic2V0QXR0cmlidXRlIiwicmVnaXN0ZXJQbHVnaW4iXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQSxDQUFDLFlBQVk7QUFFVCxNQUFNQSxNQUFNLEdBQUc7QUFDWEMsSUFBQUEsSUFBSSxFQUFF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QUFZLENBQUNuQixLQUFELENBQWxCO0FBQUEsT0FBeEM7QUFDSDtBQUNSO0FBRUQ7Ozs7Ozs7QUFLQSxXQUFTOUIsNEJBQVQsQ0FBc0NGLEtBQXRDLEVBQXlEO0FBQ3JELFFBQUlvRCxTQUFTLEdBQUdwRCxLQUFLLENBQUNxRCxhQUF0QjtBQUNBLFFBQUksQ0FBQ0QsU0FBTCxFQUNJO0FBQ0osUUFBTUUsT0FBTyxHQUFHRixTQUFTLENBQUNuQyxZQUFWLENBQXVCLGVBQXZCLENBQWhCO0FBQ0EsUUFBSXFDLE9BQUosRUFDSUYsU0FBUyxDQUFDRyxZQUFWLENBQXVCLHFCQUF2QixFQUE4QyxNQUE5QztBQUVQLEdBaEhRLENBb0hUOzs7QUFDQXpELEVBQUFBLE1BQU0sQ0FBQzBELGNBQVAsQ0FBc0IsZUFBdEIsRUFBdUNqRSxNQUF2QztBQUNILENBdEhEIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aCA9XCIuLi8uLi9ub2RlX21vZHVsZXMvQHR5cGVzL3JldmVhbC9pbmRleC5kLnRzXCIvPlxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGNvbnN0IHBsdWdpbiA9IHtcbiAgICAgICAgaW5pdDogKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgICAgICAgICBSZXZlYWwuYWRkRXZlbnRMaXN0ZW5lcignc2xpZGVjaGFuZ2VkJywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgICAgIGFkZFN1cHBvcnRGb3JUaW1lZFNlY3Rpb25zKGV2ZW50KVxuICAgICAgICAgICAgICAgIGFkZFN1cHBvcnRGb3JPbmVUaW1lU2VjdGlvbnMoZXZlbnQpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFkZFN1cHBvcnRGb3JBbmNob3JXaXRoRGF0YUxpbmsoc3R5bGUuc2hlZXQgYXMgQ1NTU3R5bGVTaGVldCk7XG4gICAgICAgICAgICBhZGRTdXBwb3J0Rm9yUHJvY2VlZFRvTmV4dEFmdGVyVmlkZW9QbGF5ZWQoKVxuXG5cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBdXRvbWF0aWMgcHJvY2VlZCB0byBuZXh0IHNsaWRlICBvbmNlIGEgdmlkZW8gaGFzIGNvbXBsZXRlZFxuICAgICAqL1xuXG4gICAgZnVuY3Rpb24gYWRkU3VwcG9ydEZvclByb2NlZWRUb05leHRBZnRlclZpZGVvUGxheWVkKCl7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTFZpZGVvRWxlbWVudD4oXCJ2aWRlb1tkYXRhLWF1dG8tbmV4dF1cIikuZm9yRWFjaCh2PT57XG4gICAgICAgICAgIHYuYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLF89PlJldmVhbC5uZXh0KCkpXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogYWxsb3dzIGZvclxuICAgICAqIGA8YSBkYXRhLWxpbmstaW5kZXhoPVwiMVwiPmxpbmsgdG8gc2xpZGU8L2E+YFxuICAgICAqIEBwYXJhbSB3ZWJ5YXJuc0NTU1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFkZFN1cHBvcnRGb3JBbmNob3JXaXRoRGF0YUxpbmsod2VieWFybnNDU1M6IENTU1N0eWxlU2hlZXQpIHtcbiAgICAgICAgd2VieWFybnNDU1MuaW5zZXJ0UnVsZShcImFbZGF0YS1saW5rLWluZGV4aF0geyBjdXJzb3I6IHBvaW50ZXIgfVwiLCAwKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcImFbZGF0YS1saW5rLWluZGV4aF1cIilcbiAgICAgICAgICAgIC5mb3JFYWNoKGUgPT4gZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBlLmdldEF0dHJpYnV0ZShcImRhdGEtbGluay1pbmRleGhcIik7XG4gICAgICAgICAgICAgICAgaWYgKHMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gcGFyc2VJbnQocywgMTApO1xuICAgICAgICAgICAgICAgICAgICBSZXZlYWwuc2xpZGUoaWR4KVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSkpXG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIC9eXFxkKyQvLnRlc3QodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogU3ludGF4XG4gICAgICogPHNlY3Rpb24gZGF0YS1hdXRvLW1vdmUtdG89XCIuLi5cIiBkYXRhLWF1dG8tbW92ZS10aW1lLXNlYz1cIi4uPlxuICAgICAqXG4gICAgICogQXV0b21hdGljYWxseSBtb3ZlcyB0byBhIHNlY3Rpb24gYWZ0ZXIgYSB0aW1lb3V0XG4gICAgICogUG9zc2libGUgdmFsdWVzIGZvciBkYXRhLWF1dG8tbW92ZS10bzpcbiAgICAgKiAgLSAnbmV4dCcgYW5kICdwcmV2J1xuICAgICAqICAtIGEgdXJsIGhhc2ggdmFsdWUgKCcjL3NvbWUtaWQnKVxuICAgICAqICAtIGlkIG9mIGEgc2VjdGlvbiAoJ3NvbWUtaWQnKVxuICAgICAqICAtIGFuIHBvc2l0aW9uIChvbmUtYmFzZWQpIG9mIGEgc2VjdGlvbiAoJzEyJylcbiAgICAgKlxuICAgICAqICBkYXRhLWF1dG8tbW92ZS10aW1lLXNlYyBpcyBvcHRpb25hbC4gRGVmYXVsdHMgdG8gMSBzZWNvbmRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGRTdXBwb3J0Rm9yVGltZWRTZWN0aW9ucyhldmVudDogU2xpZGVFdmVudCkge1xuXG4gICAgICAgIGNvbnN0IHJ4ID0gL3JhbmRvbVxcKChbMC05LFxcc10rKVxcKS87XG4gICAgICAgIGNvbnN0IGN1ckF1dG9Nb3ZlID0gZXZlbnQuY3VycmVudFNsaWRlLmdldEF0dHJpYnV0ZShcImRhdGEtYXV0by1tb3ZlLXRvXCIpO1xuICAgICAgICAgICAgaWYgKGN1ckF1dG9Nb3ZlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvdmlkZWRWYWx1ZSA9IGV2ZW50LmN1cnJlbnRTbGlkZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWF1dG8tbW92ZS10aW1lLXNlY1wiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lb3V0ID0gcHJvdmlkZWRWYWx1ZT8gTnVtYmVyLnBhcnNlRmxvYXQocHJvdmlkZWRWYWx1ZSkgKiAxMDAwIDogMTtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IGN1ckF1dG9Nb3ZlLm1hdGNoKHJ4KVxuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJBdXRvTW92ZSA9PT0gXCJuZXh0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFJldmVhbC5uZXh0KClcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJBdXRvTW92ZSA9PT0gXCJwcmV2XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFJldmVhbC5wcmV2KClcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJBdXRvTW92ZS5jaGFyQXQoMCkgPT09IFwiI1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5oYXNoID0gY3VyQXV0b01vdmU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gpe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gbWF0Y2hbMV0uc3BsaXQoXCIsXCIpLm1hcChlID0+IGUudHJpbSgpKS5tYXAoaSA9PiBOdW1iZXIucGFyc2VJbnQoaSwgMTApKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZG9tID0gdmFsdWVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbHVlcy5sZW5ndGgpXVxuICAgICAgICAgICAgICAgICAgICAgICAgUmV2ZWFsLnNsaWRlKHJhbmRvbSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNJbmRleChjdXJBdXRvTW92ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNsaWRlID0gcGFyc2VJbnQoY3VyQXV0b01vdmUsIDEwKSAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBSZXZlYWwuc2xpZGUoc2xpZGUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IFdlYnlhcm5zLmxvb2t1cEluZGV4KGN1ckF1dG9Nb3ZlKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImdldCBub3QgZmluZCBzbGlkZSB3aXRoIGlkXCIsIGN1ckF1dG9Nb3ZlKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgUmV2ZWFsLnNsaWRlKGkpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICBSZXZlYWwuYWRkRXZlbnRMaXN0ZW5lcignc2xpZGVjaGFuZ2VkJywgKCkgPT4gY2xlYXJUaW1lb3V0KHRpbWVyKSlcbiAgICAgICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBzeW50YXggPHNlY3Rpb24gb25lLXRpbWU+XG4gICAgICpcbiAgICAgKiBTZWN0aW9uIGlzIHNob3duIG9ubHkgb25lIHRpbWVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGRTdXBwb3J0Rm9yT25lVGltZVNlY3Rpb25zKGV2ZW50OiBTbGlkZUV2ZW50KSB7XG4gICAgICAgIGxldCBwcmV2U2xpZGUgPSBldmVudC5wcmV2aW91c1NsaWRlO1xuICAgICAgICBpZiAoIXByZXZTbGlkZSlcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICBjb25zdCBvbmV0aW1lID0gcHJldlNsaWRlLmdldEF0dHJpYnV0ZShcImRhdGEtb25lLXRpbWVcIik7XG4gICAgICAgIGlmIChvbmV0aW1lKVxuICAgICAgICAgICAgcHJldlNsaWRlLnNldEF0dHJpYnV0ZShcImRhdGEtaGlkZGVuLXNlY3Rpb25cIiwgXCJ0cnVlXCIpXG5cbiAgICB9XG5cblxuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIFJldmVhbC5yZWdpc3RlclBsdWdpbignV2VieWFyblBsdWdpbicsIHBsdWdpbik7XG59KSgpXG4iXX0=